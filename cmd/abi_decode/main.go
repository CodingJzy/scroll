package main

import (
	"encoding/hex"
	"fmt"
	"log"
	"scroll/abi/lp"
)

func loop(params []Param) {
	for _, param := range params {

		log.Println("===type", param.Type)
		log.Println("===name", param.Name)
		log.Println("===value", param.Value)

		switch param.Type {
		case "bytes[]":

			value, ok := param.Value.([][]uint8)
			fmt.Println("长度", len(value))
			if ok {
				for i := 0; i < 4; i++ {
					decodeMethod, err := txDataDecoder.DecodeMethod(hex.EncodeToString(value[i]))
					if err != nil {
						log.Println(err.Error())
						return
					}
					log.Println("===================", decodeMethod.Name, "===================")
					loop(decodeMethod.Params)
				}
			}

		default:
			fmt.Println("", param)
		}
	}
}

var txDataDecoder = NewABIDecoder()

func main() {
	//txData := "0x5ae401dc000000000000000000000000000000000000000000000000000000006429343500000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000a1ea0b2354f5a344110af2b6ad68e75545009a03000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a937600000000000000000000000000000000000000000000000000000000000000bb80000000000000000000000007ed71f614b88a736a05ef76edad1200f00f61a53000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000daf1be705f5cd33cca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

	txData := "0xac9650d80000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000000a40c49ccbe0000000000000000000000000000000000000000000000000000000000033fe600000000000000000000000000000000000000000000000022a676f7d1d93daf000000000000000000000000000000000000000000000069e6471b2c057e502d000000000000000000000000000000000000000000000000000ac8be21453e5600000000000000000000000000000000000000000000000000000000642cf83e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084fc6f78650000000000000000000000000000000000000000000000000000000000033fe6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffff00000000000000000000000000000000ffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004449404b7c000000000000000000000000000000000000000000000000000ac8c18e954bf00000000000000000000000001b2de9662df9983d7e87b9c064c0f6568516ec6b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064df2ab5bb000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a93760000000000000000000000000000000000000000000000069e66bde134eca0e800000000000000000000000001b2de9662df9983d7e87b9c064c0f6568516ec6b00000000000000000000000000000000000000000000000000000000"
	//txData := "0x5ae401dc00000000000000000000000000000000000000000000000000000000642982cd00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a93760000000000000000000000000a1ea0b2354f5a344110af2b6ad68e75545009a030000000000000000000000000000000000000000000000000000000000000bb80000000000000000000000001b2de9662df9983d7e87b9c064c0f6568516ec6b00000000000000000000000000000000000000000000003635c9adc5dea000000000000000000000000000000000000000000000000000000011c612aa99b9fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
	txDataDecoder.SetABI(lp.LPABIMetaData.ABI)

	method, err := txDataDecoder.DecodeMethod(txData)
	log.Println(method.Name)

	if err != nil {
		log.Fatal(err)
	}

	loop(method.Params)
}
