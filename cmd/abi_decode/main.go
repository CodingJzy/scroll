package main

import (
	"encoding/hex"
	"log"
	"scroll/abi/swap"
)

func loop(params []Param) {
	for _, param := range params {

		log.Println("type", param.Type)
		log.Println("name", param.Name)
		log.Println("value", param.Value)

		switch param.Type {
		case "bytes[]":

			value, ok := param.Value.([][]uint8)
			if ok {
				decodeMethod, err := txDataDecoder.DecodeMethod(hex.EncodeToString(value[0]))
				if err != nil {
					log.Println(err.Error())
					return
				}
				log.Println(decodeMethod.Name)
				loop(decodeMethod.Params)
			}

		default:
		}
	}
}

var txDataDecoder = NewABIDecoder()

func main() {
	//txData := "0x5ae401dc000000000000000000000000000000000000000000000000000000006429343500000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000a1ea0b2354f5a344110af2b6ad68e75545009a03000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a937600000000000000000000000000000000000000000000000000000000000000bb80000000000000000000000007ed71f614b88a736a05ef76edad1200f00f61a53000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000daf1be705f5cd33cca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

	txData := "0x5ae401dc0000000000000000000000000000000000000000000000000000000064298c0800000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a93760000000000000000000000000a1ea0b2354f5a344110af2b6ad68e75545009a0300000000000000000000000000000000000000000000000000000000000001f40000000000000000000000001b2de9662df9983d7e87b9c064c0f6568516ec6b00000000000000000000000000000000000000000000003635c9adc5dea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
	//txData := "0x5ae401dc00000000000000000000000000000000000000000000000000000000642982cd00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000a0d71b9877f44c744546d649147e3f1e70a93760000000000000000000000000a1ea0b2354f5a344110af2b6ad68e75545009a030000000000000000000000000000000000000000000000000000000000000bb80000000000000000000000001b2de9662df9983d7e87b9c064c0f6568516ec6b00000000000000000000000000000000000000000000003635c9adc5dea000000000000000000000000000000000000000000000000000000011c612aa99b9fd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
	txDataDecoder.SetABI(swap.SwapABIMetaData.ABI)

	method, err := txDataDecoder.DecodeMethod(txData)
	log.Println(method.Name)

	if err != nil {
		log.Fatal(err)
	}

	loop(method.Params)
}
